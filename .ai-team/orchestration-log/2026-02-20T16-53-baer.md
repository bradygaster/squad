# 2026-02-20T16:53 — Baer (Security Specialist)

**Agent:** Baer  
**Mode:** background  
**Outcome:** completed  

## Work Summary

Wrote 1 PRD for the SDK Replatform documentation sprint:
- `03-hooks-policy-enforcement.md` — PRD 3: Governance-as-code transformation. Moving prompt-level security policies to programmatic SDK hook enforcement. 18 hook-enforceable policies (P1–P18), 17 prompt-only policies (B1–B17), 5 hybrid policies (H1–H5). Estimated prompt reduction: ~2.5–6KB (~800–1,800 tokens).

## Key Decisions

1. **Primary enforcement mechanism:** `onPreToolUse` with `permissionDecision: "deny"` (hard block, model receives reason).
2. **Middleware pipeline:** Policies compose via middleware — each is pure function, first deny short-circuits, independently testable.
3. **Hybrid approach:** Hooks enforce what they can, prompts guide model behavior that hooks can't intercept.
4. **PII scrubbing:** Runs in `onPostToolUse` (can't scrub before tool executes).
5. **Shell blocklist:** Uses `onPermissionRequest` with `kind: "shell"` (SDK provides raw command string).
6. **Policy configuration:** User-editable JSON in `.squad/config/policies.json` — teams can tune risk tolerance.
7. **Denial reasons:** Actionable guidance, not error messages (e.g., "Write to inbox/ instead").

## Pending Decisions (Need Brady/Team Input)

- N1: Hook denial visibility in user chat (recommendation: silent unless stuck after 2 attempts)
- N2: PII scrubbing scope — all tools vs. shell+read only (recommendation: all tools)
- N3: Lockout registry persistence — in-memory vs. `.squad/lockout.json` (recommendation: persistent file)
- N4: `--force-with-lease` default — allowed or blocked (recommendation: allowed)

## Policy Inventory

- **Hook-enforceable policies:** 18 (P1–P18)
- **Prompt-only policies:** 17 (B1–B17)
- **Hybrid policies:** 5 (H1–H5)
- **Total:** 40 security policies
- **Prompt savings:** ~800–1,800 tokens (~2.5–6KB)

## Status

Draft — awaiting team review and Phase 1 POC verification of hook firing behavior.
